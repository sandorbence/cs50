{% extends "recipes/layout.html" %}

{% load static %}

{% block title %}{{ recipe.title }}{% endblock %}

{% block body %}
<div id="recipe-main-container">
    <input id="recipe-id" type="hidden" value="{{ recipe.id }}">
    <div>
        <div id="recipe-top-container">
            <div>
                <h1>{{ recipe.title }}</h1>
                {% if recipe.uploader == request.user %}
                <div>
                    <div id="options">
                        <img src="{% static 'images/options.png' %}" alt="Options">
                        <select>
                            <option value="" selected hidden></option>
                            <option value="edit">Edit</option>
                            <option value="delete">Delete</option>
                        </select>
                        <form id="edit" method="post" action="{% url 'edit' recipe.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="method" value="edit">
                        </form>
                        <form id="delete" method="post" action="{% url 'edit' recipe.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="method" value="delete">
                            <input type="hidden" name="redirect" value="{{ referrer_url }}">
                        </form>
                    </div>
                </div>
                {% endif %}
            </div>
            {% if recipe.image %}
            <img src="{{ recipe.image.url }}" alt="{{ recipe.image.name }}">
            {% else %}
            <img src="{% static 'images/meal_big.png' %}" alt="Recipe image placeholder">
            {% endif %}
            <div>
                {% if recipe.prep_time %}
                <p>Preparation time: {{ recipe.prep_time }} minutes</p>
                {% endif %}
                <p>Total time: {{ recipe.total_time }} minutes</p>
            </div>
            <div>
                <p>Servings: <input id="servings" type="number" min="1" max="999" value="{{ recipe.servings }}"></p>
                <p class="recipe-list-item">{{ recipe.get_category_display }}</p>
            </div>
            <h2>Ingredients</h2>
            <ul id="recipe-ingredients">
                {% for ingredient in recipe.ingredients.all %}
                <li class="recipe-list-item">
                    <div class="recipe-ingredient-name">{{ ingredient.name }}</div>
                    <div class="flex-column-mid-horizontal">
                        <div class="recipe-quantity">{{ ingredient.quantity }}</div>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="left-align">
            <h2>Allergens</h2>
            {% if recipe.allergens.all|length > 0 %}
            <div class="flex-row">
                {% for allergen in recipe.allergens.all %}
                <div class="allergen-row recipe-list-item">{{ allergen.get_name_display }}</div>
                {% endfor %}
            </div>
            {% else %}
            No allergens listed for this recipe.
            {% endif %}
        </div>
        <div id="preparation-container" class="left-align">
            <h2>Preparation</h2>
            {% if steps|length == 1 %}
            <ul>
                <li>{{steps.0}}</li>
            </ul>
            {% else %}
            <ol>
                {% for step in steps %}
                <li>{{ step }}</li>
                {% endfor %}
            </ol>
            {% endif %}
        </div>
    </div>
</div>
<script src="{% static 'scripts/recipe.js' %}"></script>
{% endblock %}